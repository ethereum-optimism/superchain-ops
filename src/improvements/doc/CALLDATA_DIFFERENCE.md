# Overview

With this task tooling upgrade, we want to make sure that the calldata and hashes generated by the new task simulation tooling are the exact same as the calldata and hashes generated by the current tooling.

Testing a task where the gas targets are set to 60,000,000, which is a single call yielded different calldata. This difference in calldata is due to the fact that the current tooling uses the `aggregate3()` function on the multicall contract, while the new tooling uses the `aggregate3Value()` function on the multicall contract. This enables the new task tooling to support value being sent in a task.

## Current Tooling

### Calldata Sent From Safe:
```
0x82ad56cb000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000229047fed2591dbec1ef1118d64f7af3db9eb290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000024b40a817c000000000000000000000000000000000000000000000000000000000393870000000000000000000000000000000000000000000000000000000000
```

## Function Selector
```solidity
aggregate3((address,bool,bytes)[])
```

### Function Parameters

target: `0x229047fed2591dbec1eF1118d64F7aF3dB9EB290`
allowFailure: false
data: `0xb40a817c0000000000000000000000000000000000000000000000000000000003938700`, calls setGasLimit to 60,000,000

`nonce = 14`

### Command

**note**: you must comment out line 36 in task [file](../../../tasks/eth/020-set-gas-target/SignFromJson.s.sol)

```bash
cd tasks/eth/020-set-gas-target ; SIMULATE_WITHOUT_LEDGER=1 just --dotenv-path $(pwd)/.env --justfile ../../../single.just simulate
```

## New Tooling

### Calldata Sent From Safe:
```
0x174dea71000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000229047fed2591dbec1ef1118d64f7af3db9eb2900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000024b40a817c000000000000000000000000000000000000000000000000000000000393870000000000000000000000000000000000000000000000000000000000
```

### Multicall Function Selector
```solidity
aggregate3Value((address,bool,uint256,bytes)[])
```

### Function Parameters

target: `0x229047fed2591dbec1eF1118d64F7aF3dB9EB290`
allowFailure: false
value: 0
data: `0xb40a817c0000000000000000000000000000000000000000000000000000000003938700`, calls setGasLimit to 60,000,000


`nonce = 14`

command:
```bash
forge script src/improvements/template/GasConfigTemplate.sol --sig "simulateRun(string)" test/tasks/mock/configs/OPMainnetGasConfigTemplate.toml --rpc-url mainnet -vvv
```

Calldata diff can be found here https://www.diffchecker.com/HA7YFSWi/, select character comparison to see the difference.


## Using OP Verify

First we need to generate an inputs file which we would use as an input to the OP Verify tool. To do this we run this command, firstly, `cd` into the folder of the task, next run

```
SIMULATE_WITHOUT_LEDGER=1 just --dotenv-path $(pwd)/.env --justfile ../../../../../src/improvements/single.just simulate true "<output file name>.json"
```

This will generate a file with the name `<output file name>.json`. It will also print the domain and message hashes from the local simulation, keep note of this.

Next we need to clone the OP Verify repository from https://github.com/ethereum-optimism/op-verify

```bash
git clone https://github.com/ethereum-optimism/op-verify
```

Next create a file in the `op-verify` directory called `<output file name>.json` and copy-paste the contents of the `<output file name>.json` file to it. Then run

```bash
go run ./cmd/op-verify --tx <file name>.json
```

This will output details about the transaction, including the domain and message hashes. **Compare these to the domain and message hashes you noted down earlier to check if the OP Verify tool is working correctly.**